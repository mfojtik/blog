<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<title> Deltacloud is now modular and offers the drivers API &middot; mfojtik blog </title>


<link rel="stylesheet" href="http://mfojtik.io/css/slim.css">
<link rel="stylesheet" href="http://mfojtik.io/css/highlight.min.css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro' rel='stylesheet' type='text/css'>

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/favicon.ico">

</head>

<body>
  <div class="container">
    <div class="header">
  <h1 class="site-title"><a href="http://mfojtik.io">mfojtik blog</a></h1>
  <p class="site-tagline"><em>Look at you, hacker. A pathetic creature of meat and bone, panting and sweating as you run through my corridors. How can you challenge perfect immortal machine</em></p>
  <div class="nav">
    <a class="nav-btn" href="#">
      <span class="ci ci-burger"></span>
    </a>
    <ul class="nav-list">
       
	  <li class="spacer">&ac;</li>

      <li><a href="https://github.com/mfojtik">Github</a></li> 
      <li><a href="https://twitter.com/mfojtik">Twitter</a></li> 
    </ul>
  </div>
</div>

    <div class="content">
      <div class="posts">
        <div class="post">
          <h2 class="post-title"><a href="http://mfojtik.io/post/deltacloud-as-library-and-more/">Deltacloud is now modular and offers the drivers API</a></h2>
          <span class="post-date">Apr 22, 2012 </span>
          <div class="post-content">
            <p>The <a href="http://deltacloud.org">Deltacloud API</a> revamp is now done and pushed to our
<a href="https://git-wip-us.apache.org/repos/asf/deltacloud.git">master GIT repo</a>.  The
revamp itself does not affect the backward compatibility nor introduces any API
schema changes. The main goal of this work is to make Deltacloud API a <a href="http://www.sinatrarb.com/intro#Modular%20vs.%20Classic%20Style">modular
Sinatra</a>
application, thus pluggable to any other Rack-based web application (Rails,
Padrino, Sinatra, etc..). As a side effect, since we do not use the Sinatra
methods in a global namespace, this revamp also introduces the possibility to
use Deltacloud API as a Ruby library. It means that in case you don&rsquo;t want to use
the REST server or for some reason (networking, security, etc&hellip;) you can&rsquo;t, you
can now just <code>require &lsquo;deltacloud/api&rsquo;</code> and profit from the
drivers API. Please note that the library code is now <strong>very experimental</strong> and we
don&rsquo;t promise that it will work as you expect or it will not change in the near
future.</p>

<p>So how does the Sinatra::Base code work? After you install the <em>&lsquo;deltacloud-core&rsquo;</em>
gem, you should be able to just <code>require &lsquo;deltacloud_rack&rsquo;</code> and then mount the DC
API container in this way:</p>

<pre class="sh_ruby">
require 'deltacloud_rack'

Deltacloud::configure do |server|
  server.root_url '/api'
  server.version '0.5.0'
  server.klass 'Deltacloud::API'
end

run Rack::Builder.new {
  use Rack::MatrixParams
  use Rack::DriverSelect

  run Rack::URLMap.new(
    "/" => MyApplication.new,
    "/api" => Deltacloud[:klass],
  )
}
</pre>

<p>There are several use-cases when the Sinatra::Base approach could be useful.
In case you need for some reason to add your own collections or just introduce
some &lsquo;stateful&rsquo; operations, it should be much more easy now than with
the Sinatra::Application we were using before.</p>

<p>The other, very nifty feature is that you can now use Deltacloud drivers API
in your Ruby applications without even starting a REST server. This could be
handy if you&rsquo;re stuck with gems like &lsquo;fog&rsquo;, or your application requires a very
consistent API with the same abstraction for all cloud providers.</p>

<p>There is a small code example how you can use the library code:</p>

<pre class="sh_ruby">
require 'deltacloud/api'

Deltacloud.new(:ec2, :user => API_KEY, :password => API_SECRET) do |c|
  c.create_instance('ami-12345')
end
#
# or
#
Deltacloud.new(:mock) do |driver|
  puts driver.hardware_profiles
end

</pre>

<p>The drivers API is described
<a href="http://deltacloud.apache.org/developers.html#h2_4">here</a>, but the new, more
detailed documentation should appear soon. Meanwhile, you can use the
<a href="http://omicron.mifo.sk/deltacloud-core/doc">YARD</a> documentation I generated.</p>

          </div>
        </div>
        <div class="pagination">
          <a class="btn previous " href="http://mfojtik.io/post/nicer-ruby-exceptions/"> Prev</a>  
          <a class="btn next " href="http://mfojtik.io/post/deltacloud-api-using-sinatra-modular-app/"> Next</a> 
        </div>
      </div>
    </div>
    
    <div class="footer">
  <p>Powered by <a href="http://gohugo.io">hugo</a> and the <a
    href="https://github.com/zhe/hugo-theme-slim">slim</a> theme.</p>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109743259-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109743259-2');
</script>

  </div>
  <script src="http://mfojtik.io/js/slim.js"></script>
  <script src="http://mfojtik.io/js/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
</body>

</html>
